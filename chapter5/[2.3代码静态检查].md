# 代码静态检查

随着敏捷开发的实践已经逐渐深入人心，越来越多的开发者意识到文档，作为解释性的文字描述，很难和代码保持同步，因此代码的可读性和质量往往成为直接决定项目是否健壮、可维护的关键。

这就要求我们的代码具有良好的风格（包括注释、命名等）、代码格式标准、程序没有非法调用和低级bug，以及用以对功能进行解释的单元测试能够尽可能多地覆盖核心功能。如果每次我们都手动去依次检查这些点是否达标，那持续集成将变得无比缓慢，更不用说持续交付了。

所以我们通常会使用一些自动化的代码检查工具来保证我们的代码质量，在笔者的实践中，大部分项目都会使用[rubocop]()来进行ruby代码的静态检查，其大致配置如下：


```
EmptyLinesAroundBlockBody:
  Exclude:
    - 'db/schema.rb'

LineLength:
  Max: 120
  Exclude:
    - 'spec/**/*'
    - 'config/initializers/*'

MethodLength:
  Max: 20
  Exclude:
    - 'db/migrate/*'

Metrics/ClassLength:
  Max: 105

Metrics/PerceivedComplexity:
  Max: 10

WordArray:
  MinSize: 2

```

上面的配置文件中，规定了在block体前后必须有空行，每行代码最长不能超过120个符号，方法不能超过20行等，更多配置，请参考rubocop的官方文档。

另外，我们通常将代码检查工具rubocop和rake集成，这样就可以在使用rake运行自动化测试时，同时进行代码质量的检查。

如下代码所示，我们首先创建了一个task，并把RuboCop加入到rakefile的默认任务中，代码如下:

```
namespace :quality do
  begin
    require 'rubocop/rake_task'

    RuboCop::RakeTask.new(:rubocop) do |task|
      task.patterns = %w{
        app/**/*.rb
        config/**/*.rb
        lib/**/*.rb
        spec/**/*.rb
        --rails
      }
    end
  rescue LoadError
    warn "rubocop not available, rake task not provided."
  end
end
```

如上所示，我们只需要将期望被检查的文件加到task.patterns中，Rubocop就能帮我们对文件的内容进行静态检查了。
