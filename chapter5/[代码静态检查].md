# 代码静态检查

随着敏捷开发的日渐流行，文档的地位不断被削弱，此时代码的可读性和质量往往成为直接决定项目是否健壮可维护的关键。这就要求我们的代码具有良好的风格（包括注释、命名等）、代码格式标准、程序没有非法调用和低级bug，以及用以对功能进行解释的单元测试能够尽可能多地覆盖核心功能。如果每次我们都手动去依次检查这些点是否达标，那持续集成将变得无比缓慢。更遑论持续交付了。

所以我们通常会使用一些自动化的代码检查工具来保证我们的代码质量，在本例中，笔者使用了rubocop来进行ruby代码的静态检查，部分配置如下：

```
EmptyLinesAroundBlockBody:
  Exclude:
    - 'db/schema.rb'

LineLength:
  Max: 120
  Exclude:
    - 'spec/**/*'
    - 'config/initializers/*'

MethodLength:
  Max: 20
  Exclude:
    - 'db/migrate/*'

Metrics/ClassLength:
  Max: 105

Metrics/PerceivedComplexity:
  Max: 10

WordArray:
  MinSize: 2

```

上面的配置文件中，规定了在block体前后必须有空行，每行代码最长不能超过120个符号，方法不能超过20行等，更多配置，请参考rubocop的官方文档。我们通常希望将代码检查工具和rake集成，这样我们就可以在使用rake运行自动化测试时，同时进行代码质量的检查，为了达到这个目的，我们只需要为它创建一个rake task，并把它加入rakefile的默认任务中，代码如下:

```
namespace :quality do
  begin
    require 'rubocop/rake_task'

    RuboCop::RakeTask.new(:rubocop) do |task|
      task.patterns = %w{
        app/**/*.rb
        config/**/*.rb
        lib/**/*.rb
        spec/**/*.rb
        --rails
      }
    end
  rescue LoadError
    warn "rubocop not available, rake task not provided."
  end
end
```

我们可以看到，在这个rake task中，我们只需要将期望被检查的文件加到task.patterns中即可，其他的任务就交给Rubocop帮我们处理吧。
