# 概述

在前一小节中介绍了如何自动化构建一个能够运行微服务的docker镜像包并将其发布到了docker registry上，这时我们就可以在任何一台安装了docker的机器上运行它了。由于是示例，笔者在这里编写了一个简单的脚本，你可以使用ssh登录想要部署的机器，并且执行下面的脚本，当然，我们也让该脚本在机器启动时自动执行。

```
#! /bin/bash
set -e

[[ -z $BUILD_NUMBER ]] && echo "Need BUILD_NUMBER" && exit 1
[[ -z $PRODUCT_DB_URL ]] && echo "Need PRODUCT_DB_URL" && exit 1
[[ -z $PRODUCT_DB_USERNAME ]] && echo "Need PRODUCT_DB_USERNAME" && exit 1
[[ -z $PRODUCT_DB_PASSWORD ]] && echo "Need PRODUCT_DB_PASSWORD" && exit 1
[[ -z $ENV ]] && echo "Need ENV" && exit 1

DOCKER_REGISTRY_URL="YOUR REGISTRY URL"
DOCKER_REGISTRY_USER_NAME="USER NAME"
APP_NAME=${APP_NAME:-product-service}
APP_VERSION=$(cat MAJOR_VERSION).$BUILD_NUMBER
FULL_TAG=${DOCKER_REGISTRY_URL:="localhost"}/$DOCKER_REGISTRY_USER_NAME/$APP_NAME:$APP_VERSION

echo "Pulling Docker image from Registry"
docker pull $FULL_TAG

echo "Launching Dokcer Container"
docker run -d -p 80:80 --name product-service -e PRODUCT_DB_URL=$PRODUCT_DB_URL -e PRODUCT_DB_USERNAME=$PRODUCT_DB_USERNAME -e PRODUCT_DB_PASSWORD=$PRODUCT_DB_PASSWORD -e RACK_ENV=$ENV $FULL_TAG

```

这个脚本会自动将我们之前发布的docker镜像包pull到本地，并且通过docker run为我们启动一个docker container，在执行docker run时，-e可以通过参数设置需要的环境变量，-p 80:80指的是将docker container的80端口映射到docker host的80端口，到这里，我们就可以通过docker host的80端口访问我们的服务了。
