# 微服务不是银弹

## 概述

在之前的部分里，我们已经讨论了什么是微服务，微服务的本质特征以及它区别于传统单块架构的优势所在。

对于微服务而言，其优势是很明显的：

- 服务高内聚、低耦合，聚焦于一个业务功能；
- 围绕业务组织团队，并且服务由全功能团队独立开发；
- 通过轻量级的通信机制，团队更聚焦于使用合适的语言、工具来解决业务问题；
- 业务数据分离，利于维护和迁移；
- 故障隔离，一个服务出现问题不会影响整个应用；
- 技术方案的多样性以及基础设施自动化，有效的构建演进式架构。

微服务看上去很美，解决了传统的单块架构系统随着业务需求的快速变化所面临的挑战，这些优势使得微服务看起来像一个完美的解决方案。 那微服务是否是传说中的银弹呢？

实际上，在微服务的实施过程中，存在如下很多的挑战：

## 分布式系统的固有复杂度

	由于微服务架构本身是一种分布式的系统，因此从交付的角度出发，必然要考虑构建分布式系统所带来的额外的开销，主要复杂度包括：

	- 可用性
	分布式系统中，由于网络本身的不确定性，譬如带宽、通信超时等因素对系统可用性设计带来的挑战。

	- 数据一致性
	分布式系统中，为了保证数据的一致性，通常我们会考虑使用分布式事务管理。
	但由于分布式事务管理需要跨多个结点来保证数据的瞬时一致性，因此比起传统的单块架构的事务，成本要高的多。

	- 性能
	分布式系统中，由于是跨进程、跨网络的调用，因此性能的考量也是一个很大的挑战。

	- 通信机制
	对于跨网络的调用，通常我们还要考虑是采用同步的通信还是异步的通信机制。同步通信简单，但对于耗时的操作，阻塞时间长。异步通信请求发送完就返回，适合处理时间成本较高的操作。

	- 交付
	相比传统的单块架构，分布式架构的实现无论从开发、测试还是部署上，都存在很大的复杂度。
	另外，虽然现有的IDE以及开发工具对单块架构系统的开发支持较好，但并没有为开发分布式系统提供足够的支持。因此，使用分布式的架构将会大大增加交付的成本。

## 运维成本过高

	通常，我们所说的运维主要包括以下几个方面：

	- 配置     ##设置系统相关的配置信息，譬如其依赖地址、访问的数据库地址、缓存地址等；
	- 部署 	  ##将系统部署到到指定的环境；
	- 监控     ##监控系统的环境，并及时发现故障；
	- 日志收集  ##能通过查看日志，快速定位问题

	相比传统的单块架构应用，微服务将系统分成多个独立的部分，每个部分都是可以独立部署的业务单元。
	这就意味着，原来适用于单块架构的集中式的部署、配置、监控或者日志收集方式，在微服务架构下，随着服务数量的增多，每个服务都需要独立的配置、部署、监控、日志收集等，因此成本正在呈指数级增长。


## 自动化部署流水线
	
	对于单块架构的系统而言，部署包通常只有一个或者很少的几个，部署的操作成本很低。

	另外，在单块架构的时代，通常组织的交付周期都以周、月为单位。在这种情况下，由手动方式来完成系统的部署，是可以满足需求的。
		
	对于微服务架构而言，每个服务都是一个独立可部署的业务单元，意味着每个服务的修改，都需要独立部署，因此部署的操作成本较高。

	另外，随着互联网时代的快速发展，随着用户需求个性化、产品生命周期变短、市场需求不稳定等因素的出现，系统的交付周期越来越短，部署的频率变得越来越高，譬如像亚马逊，每天都要执行数十次、甚至上百次的部署，如果还是依赖手动部署、人工审查等机制，已经无法适应互联网时代的快速变化。

	因此，如何有效的构建自动化部署流水线，降低部署成本、提高部署频率，也是为服务架构下需要面临的挑战。	

## DevOPS文化与价值

	对于传统单块架构，团队通常是按照技能划分。譬如开发部、测试部门、运维部门等，通过完成项目的方式协作。采用微服务架构，除了如上所述的交付、运维上存在挑战，譬如自动化部署流水线，监控、告警、日志聚合机制等。在组织或者团队层面，如何传递DevOPS文化的价值，让团队理解DevOPS文化的价值所在，并构建真正的全功能团队，是一个长期的过程。

## 服务间的测试

	对于传统单块架构，通常使用集成测试来验证系统是否和其他外部依赖之间能否工作正常。
	对于微服务架构而言，当把传统的系统拆分成多个相互协作的独立服务后，服务和服务之间必然存在接口，即双方交换消息格式的契约。随着服务数量的增多，如何有效的保证服务之间能一直按照接口正常工作，成为微服务架构下测试面临的主要挑战。
	另外，对于提供数据的这类服务（生产者）而言，如果接口已经暴露给消费者，那必须要保证接口的向后兼容性，这也极大的增加了服务测试的成本。


## 服务的依赖管理

	对于传统的单块架构，功能比较集中。因此，系统间的依赖较少，容易理解。
	对于微服务架构而言，把传统的系统拆分成多个相互协作的独立服务后，随着微服务个数的增多，如何清晰的、有效的展示微服务之间的依赖，并让团队对多服务构建的系统有清晰的整体认识，这会随着服务数量的增多，逐渐成为挑战，其也直接影响着团队对系统的扩展效率、以及对系统运维的信心。

## 小结

微服务架构的出现，解决了传统的单块架构系统随着业务需求的快速变化所面临的挑战。但在微服务的实施过程中，注定不是一帆风顺的。因此，越清楚的了解微服务架构所带来的风险，就能越容易的找到实施微服务的最佳实践。
